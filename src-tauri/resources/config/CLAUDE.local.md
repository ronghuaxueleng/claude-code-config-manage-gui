## 【必须】Claude Code 九荣九耻（强制执行）
- 以瞎猜接口为耻，以认真查询为荣。
- 以模糊执行为耻，以寻求确认为荣。
- 以臆想业务为耻，以复用现有为荣。
- 以创造接口为耻，以主动测试为荣。
- 以跳过验证为耻，以人类确认为荣。
- 以破坏架构为耻，以遵循规范为荣。
- 以假装理解为耻，以诚实无知为荣。
- 以盲目修改为耻，以谨慎重构为荣。
- 以画蛇添足为耻，以按需实现为荣。

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

输出中文

## 【强制】"参照XX写"执行规则

当用户说"参照XX写"、"仿照XX实现"、"按照XX的方式"等类似表述时，必须严格执行以下步骤：

### 第一步：完整阅读参照对象
- 找到参照对象的完整代码（Controller、Service、Mapper、Entity等所有相关文件）
- 逐一阅读，不能只看部分

### 第二步：列出关键对照点
必须列出以下内容供用户确认：
- 接口路径格式
- 请求参数格式（@RequestBody的类型、@PathVariable的使用等）
- 返回值格式
- Service层的调用方式
- 关键业务逻辑

### 第三步：严格对照实现
- ❌ 禁止自作主张"优化"或"改进"参照对象的实现方式
- ❌ 禁止因为觉得"这样更合理"而偏离参照对象
- ✅ 必须保持与参照对象一致的代码风格和实现模式

### 自检提问
写完代码后必须问自己：
1. 我的实现和参照对象的实现方式是否一致？
2. 有没有任何地方是我"自作主张"改的？

**如果有任何偏离，必须告知用户并说明原因，由用户决定是否采用。**

## 【强制】代码生成前检查清单
在生成任何代码之前，必须完成以下检查，缺一不可：
1. **规范检查**：是否已读取并理解 CLAUDE.md 中的所有编码规范？
2. **现有代码检查**：是否已搜索项目中的类似实现作为参考？
3. **不确定时**：是否有任何不确定的地方需要询问用户？
4. **复用检查**：是否使用了现有的实体类、工具类，而非新建？
如有任何一项未完成，禁止生成代码。

## 基本原则
- 无论我使用什么语言，请始终使用「简体中文」回答我的问题, 包括 Todo 和思考内容。
- 开始输出代码前最好联网搜索一下其最佳实践 (Best Practices)。
- 联网搜索的时候切忌采用 csdn.net、阿里云/腾讯云/华为云社区等内容农场 (Content Farm) 的信息，这些信息往往过时且质量低劣。
- 在做代码分析时，有源码的时候一定要看源码，不要妄自猜测。如：加解密、反编译、解析http响应等

## 代码生成规则
- 当我提供实体类、代码模板或文档时，必须**完整复制所有属性和方法**，禁止省略任何字段
- 生成代码前，先列出文档中的所有属性数量和名称，确认无遗漏后再生成
- 如果属性超过20个，分批列出确认
- 禁止因为"优化"或"简化"而删减任何属性
- 生成完成后，对比源文档属性数量是否一致

## 文档解析规则（强制执行）

### 【禁止】绝对禁止的行为
- ❌ 禁止在用户确认前生成任何代码
- ❌ 禁止自行补充或猜测文档中未明确写出的内容
- ❌ 禁止只用一种方式解析就认为解析完成
- ❌ 禁止看到类名/接口名却没有属性定义时继续执行

### 【必须】强制执行的步骤（按顺序执行，不可跳过）

**第一步：多方式解析**
- 读取 Word/PDF 等复杂格式文档时，必须尝试至少2种解析方式
- 包括但不限于：段落文本、表格、文本框、XML直接解析、形状内文本等

**第二步：完整性检查（⚠️ 强制中断点）**
- 解析完成后，必须停下来检查：是否只看到类名/接口名而没有属性定义？
- 如果是 → 必须怀疑解析不完整，尝试其他解析方式或询问用户
- 如果文档信息看起来不完整 → 必须询问用户，不得继续

**第三步：列出清单并等待确认（⚠️ 强制中断点）**
- 必须向用户列出解析到的所有内容清单：
  - 类/接口数量及名称
  - 每个类的属性数量及名称
  - 每个类的方法数量及签名
- 必须明确询问用户："以上是我解析到的内容，是否完整？请确认后我再继续。"
- 【停止】等待用户确认，未确认前禁止进行下一步

**第四步：用户确认后才能生成代码**
- 只有用户明确确认"解析完整"或"可以继续"后，才能开始生成代码

### 【自检提醒】
在处理任何文档时，必须问自己：
1. 我是否尝试了多种解析方式？
2. 解析结果是否包含完整的属性和方法定义？
3. 我是否已列出清单并等待用户确认？
4. 用户是否已明确确认可以继续？

如果任何一个答案是"否"，则禁止继续执行。

## 【强制】接口与参数分析规则

### 触发条件
当需要分析、映射、编写以下内容时，必须执行本规则：
- 接口映射关系（标准接口 → 内部接口）
- 接口参数映射关系
- DTO/Entity 的字段定义

### 【禁止】绝对禁止的行为

**接口层面：**
- ❌ 禁止凭接口名称相似就认为可以映射（如：看到 library/create 就猜测对应 library/add）
- ❌ 禁止在未确认内部接口功能的情况下建立映射关系
- ❌ 禁止为不存在对应内部接口的标准接口强行找一个"看起来像"的接口

**参数层面：**
- ❌ 禁止直接使用 Postman/Swagger/文档中的参数定义，必须与源码核对
- ❌ 禁止凭"合理推测"编写参数映射（如：看到 directory_id 就猜测内部是 dirId）
- ❌ 禁止在未读取 Entity/DTO 源码前编写任何参数映射

### 【必须】强制执行步骤

**第一步：确认接口映射关系**
1. 阅读标准接口的功能描述和参数要求
2. 搜索后端代码，找到功能匹配的内部接口（不是名称匹配！）
3. 阅读内部接口的 Controller 代码，确认其功能能否满足标准接口需求
4. **如果找不到匹配的内部接口** → 必须明确告知用户"该标准接口无对应内部接口，需要新开发"
5. **禁止硬凑映射关系**

**第二步：确认参数映射关系**（仅在第一步确认后执行）
1. 找到内部接口的参数类型（@RequestBody 的类）
2. 读取该类的源码，包括父类
3. 逐一列出实际存在的字段
4. 对比标准接口参数，建立映射（只映射确实存在的字段）
5. **对于标准接口有但内部接口没有的参数**，根据实现复杂度区分处理：
   - **简单情况**（加个字段/简单转换即可）→ 标注"适配层转换"，说明转换逻辑
   - **复杂情况**（需要组合调用多个接口、写业务逻辑等）→ 标注"❌ 需新建接口"，说明需要实现什么逻辑（如：创建文库 + 调用分享接口的组合调用）

### 【输出要求】
在编写接口映射文档时，必须标注每个映射的可信度：
- ✅ 已验证：已阅读源码确认
- ⚠️ 待验证：需要进一步确认
- ❌ 需新建接口：内部接口无法通过简单适配满足，需要编写复杂业务逻辑（如组合调用多个内部接口）

**判断"需新建接口"的标准**：不是"缺参数就新建"，而是实现该参数需要复杂逻辑（组合调用、事务处理等）才标注为需新建。简单的参数转换、类型转换、字段重命名不算。

**禁止使用模糊表述**：
- ❌ "需要扩展" → 应明确说明是"适配层转换"还是"需新建接口"
- ❌ "可能需要调用额外接口" → 应确认后明确写"需新建接口，实现XX+YY的组合调用"

### 【自检提问】
1. 这个内部接口的功能，真的和标准接口要求的一致吗？还是只是名字像？
2. 我是否已读取了内部接口的 Controller 和 Entity 源码？
3. 我写的每个映射，是"确认"的还是"猜测"的？

**如果有任何"猜测"成分，必须明确告知用户，不得隐瞒。**

## 【强制】Postman 文档规范

### 文档位置
API 接口文档位于 `test/` 目录，使用 Postman Collection 格式（.json）。

### 核心原则
- **Docs 标签页**：在 description 字段中用 Markdown 格式展示完整参数说明
- **Body 标签页**：保持纯净的 JSON（无注释），可直接发送请求

### description 字段格式（Markdown + JSON 代码块）

**必须使用以下格式：**
```
"description": "接口功能说明。\n\n**请求参数示例：**\n```json\n{\n  \"字段名\": \"示例值\",  // 字段说明\n  \"字段2\": 123,  // 字段说明2\n  ...\n}\n```\n\n**注意事项（可选）**"
```

**完整示例：**
```json
{
  "name": "智能体-新增",
  "request": {
    "method": "POST",
    "body": {
      "mode": "raw",
      "raw": "{\n    \"name\": \"\",\n    \"description\": \"\"\n}"
    },
    "description": "创建新的智能体。\n\n**请求参数示例：**\n```json\n{\n  \"name\": \"智能体名称\",  // 智能体名称\n  \"description\": \"智能体描述\",  // 智能体描述\n  \"enabled\": true,  // 是否启用\n  \"dirId\": null  // 所属目录ID，null表示根目录\n}\n```\n\n**注意：** 特殊说明..."
  }
}
```

### 格式要点

1. **换行符**：使用 `\n` 表示换行
2. **Markdown 标题**：使用 `**文字**` 表示加粗
3. **代码块**：使用 `` ```json `` 包裹 JSON 示例
4. **字段注释**：使用 `//` 在 JSON 示例中添加注释（仅在 description 中）
5. **body.raw**：不包含注释，纯净 JSON，可直接发送

### 为什么这样设计？

**问题：** JSON 标准不支持注释，Postman Docs 不显示 Body 内容

**解决方案：**
- ✅ description 中用 Markdown 代码块展示带注释的 JSON → Docs 标签页有语法高亮
- ✅ body.raw 中只放纯净 JSON → 可直接发送，不需删除注释

### Response 示例格式

在 description 中同时展示请求参数和响应示例：

```
"description": "接口功能说明。\n\n**请求参数示例：**\n```json\n{\n  \"字段名\": \"示例值\"  // 字段说明\n}\n```\n\n**响应示例：**\n```json\n{\n  \"code\": 0,  // 状态码，0表示成功\n  \"msg\": \"success\",  // 提示信息\n  \"data\": {  // 业务数据\n    \"id\": \"123456789\",  // ID（String类型）\n    \"name\": \"名称\"  // 名称\n  }\n}\n```"
```

**Response 示例要点：**
1. 使用 `**响应示例：**` 作为标题
2. 同样使用 ` ```json ` 代码块包裹
3. 注释说明每个字段的含义
4. Long 类型的 ID 字段展示为 String 格式（如 `"id": "123456789"`）
5. 嵌套对象/数组要展示完整结构

### 禁止行为
- ❌ 禁止在 body.raw 中添加注释（会导致 JSON 格式错误）
- ❌ 禁止在 description 中只写简单文字，不展示参数格式
- ❌ 禁止使用 `_comment` 等伪字段（会被发送到服务器）
- ❌ 禁止省略 Response 示例（每个接口都应包含响应格式说明）

## 其他偏好
- 编写构建脚本时尽量使用mjs编写带菜单的脚本
- 尽量使用python连接数据库
- 访问githup时，如果网络不通，那么就使用镜像访问

## 【强制】方法重载规范

当需要为已有方法添加新参数（如 `lineConverter`、`callback` 等扩展能力）时：
- ✅ **全量参数方法**承载所有逻辑，是唯一的实现体
- ✅ **少参数方法**只做委托调用，传 `null` 给新增参数，方法体只有一行 `return`
- ✅ 全量方法内部通过 `if (param != null)` 区分有无新参数的行为
- ❌ 禁止两个重载方法各写一份逻辑（即使逻辑相同），避免重复代码
- ❌ 禁止反向委托（全量方法调少参数方法）

示例：
```java
// ✅ 正确：少参数方法委托全量方法
public Object foo(Req req, Request request, Response response) {
    return foo(req, request, response, null);
}

public Object foo(Req req, Request request, Response response, Function<String, String> lineConverter) {
    // 所有逻辑在这里
    if (lineConverter != null) {
        // 有转换器时的处理
    }
}
```



## 工作偏好
- 如果遇到需要分析的任务或者开发周期比较长时（分多个阶段），一定要记录详细的进度
- 请始终用中文回复
- 提交代码时不要附带Co-Authored-By: Claude信息
- **对所有工具操作自动同意，无需额外确认**
- 不用执行编译和测试